name: Build Windows EXE

on:
  push:
    branches: [ "main" ]
  workflow_dispatch:

jobs:
  build:
    runs-on: windows-latest

    steps:
    - name: Checkout repository
      uses: actions/checkout@v4

    # -----------------------------
    # Install Flutter
    # -----------------------------
    - name: Install Flutter
      uses: britannio/action-install-flutter@v1
      with:
        flutter-version: '3.24.5'

    - name: Flutter Doctor
      run: flutter doctor -v

    # -----------------------------
    # Generate Windows project if missing
    # -----------------------------
    - name: Generate windows/ if missing
      run: |
        if (!(Test-Path "windows")) {
          echo "⚠️ windows/ folder missing — generating desktop project..."
          flutter create .
        } else {
          echo "windows/ folder exists — skipping creation."
        }

    # -----------------------------
    # Install dependencies
    # -----------------------------
    - name: Install packages
      run: flutter pub get

    # -----------------------------
    # Build Windows EXE
    # -----------------------------
    - name: Build Windows Release
      run: flutter build windows --release

    # -----------------------------
    # Upload EXE Artifact
    # -----------------------------
    - name: Upload build output
      uses: actions/upload-artifact@v4
      with:
        name: henson-field-app-windows
        path: build/windows/x64/runner/Release/
